window.onload=function(){let e='<svg t="1629004332697" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3111" width="16" height="16"><path d="M914.56 463.78z m-110.53 0q0 30.34 14.63 55.81 14.63 25.46 40.63 40.09 26 14.63 54.72 14.63t55.26-14.63q26.55-14.63 40.63-40.09 14.09-25.47 14.09-55.27 0-29.8-14.09-55.27-14.08-25.46-40.63-40.63-26.55-15.17-55.26-15.17-28.72 0-54.72 15.17t-40.63 40.63q-14.63 25.47-14.63 54.73z m110.53 358.67z m-110.53 0q0 29.26 14.63 54.72 14.63 25.47 40.63 40.63 26 15.17 54.72 15.17t55.26-15.17q26.55-15.17 40.63-40.63 14.09-25.46 14.09-55.26 0-29.8-14.09-54.73-14.08-24.92-40.63-39.55Q942.72 713 914.01 713q-28.72 0-54.72 14.63t-40.63 39.55q-14.63 24.93-14.63 55.27z m-284.99 0z m-109.44 0q0 46.6 30.88 78.02 30.88 31.42 78.55 32.51 46.6-1.09 78.03-32.51 31.42-31.42 32.5-78.02-1.08-47.68-32.5-78.56-31.43-30.88-78.03-30.88-47.67 0-78.55 30.88-30.88 30.88-30.88 78.56z m109.44-358.67z m-109.44 0q0 47.68 30.88 78.56 30.88 30.88 78.55 31.97 46.6-1.09 78.03-31.97 31.42-30.88 32.5-78.56-1.08-46.59-32.5-77.47-31.43-30.88-78.03-33.06-47.67 2.17-78.55 33.06-30.88 30.88-30.88 77.47z m504.96-353.25z m-110.53 0q0 29.25 14.63 54.72t40.63 40.63q26 15.17 54.72 15.17t55.26-15.17q26.55-15.17 40.63-40.63 14.09-25.47 14.09-55.26 0-29.8-14.09-54.72-14.08-24.93-40.63-40.09Q942.72 0.01 914.01 0.01q-28.72 0-54.72 15.17t-40.63 40.09q-14.63 24.92-14.63 55.27zM109.44 822.45zM0 822.45q1.08 29.26 15.17 54.72 14.09 25.47 40.09 40.63 26 15.17 54.72 15.17t55.27-15.17q26.55-15.17 40.63-40.63 14.09-25.46 15.17-54.72-2.16-47.68-33.05-78.56-30.88-30.88-78.56-30.88-46.59 0-77.47 30.88Q1.09 774.77 0.01 822.45z" p-id="3112"></path></svg>',t='<svg t="1632228228676" class="icon" viewBox="0 0 1214 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="15810" width="12" height="12"><path d="M964.352982 196.442274H250.01744A53.575166 53.575166 0 0 0 196.442274 250.01744v339.309382A53.575166 53.575166 0 0 0 250.01744 642.901988h214.300663l117.508196 117.508197a35.716777 35.716777 0 0 0 50.717824 0L750.052319 642.901988h214.300663a53.575166 53.575166 0 0 0 53.575166-53.575166V250.01744A53.575166 53.575166 0 0 0 964.352982 196.442274z" fill="#FFC824" p-id="15811"></path><path d="M607.185211 477.53331a35.716777 35.716777 0 0 1-35.716777-35.716777v-53.575166a35.716777 35.716777 0 1 1 71.433554 0v53.575166a35.716777 35.716777 0 0 1-35.716777 35.716777zM383.955354 477.53331a35.716777 35.716777 0 0 1-35.716777-35.716777v-53.575166a35.716777 35.716777 0 1 1 71.433554 0v53.575166a35.716777 35.716777 0 0 1-35.716777 35.716777zM830.415068 477.53331a35.716777 35.716777 0 0 1-35.716777-35.716777v-53.575166a35.716777 35.716777 0 1 1 71.433554 0v53.575166a35.716777 35.716777 0 0 1-35.716777 35.716777zM361.453784 71.433554h-17.858388a35.716777 35.716777 0 0 1 0-71.433554h17.858388a35.716777 35.716777 0 0 1 0 71.433554z" fill="#6B400D" p-id="15812"></path><path d="M607.185211 1024a107.150331 107.150331 0 0 1-75.719567-31.430764l-153.224974-153.224974H142.867108a142.867108 142.867108 0 0 1-142.867108-142.867108V142.867108a142.867108 142.867108 0 0 1 142.867108-142.867108h53.575166a35.716777 35.716777 0 0 1 0 71.433554H142.867108a71.433554 71.433554 0 0 0-71.433554 71.433554v553.610046a71.433554 71.433554 0 0 0 71.433554 71.433554h250.01744a35.716777 35.716777 0 0 1 25.358912 10.357865l163.582839 163.940007a35.716777 35.716777 0 0 0 50.717824 0l163.582839-163.940007a35.716777 35.716777 0 0 1 25.358912-10.357865h250.01744a71.433554 71.433554 0 0 0 71.433554-71.433554V142.867108a71.433554 71.433554 0 0 0-71.433554-71.433554H535.751657a35.716777 35.716777 0 0 1 0-71.433554h535.751657a142.867108 142.867108 0 0 1 142.867108 142.867108v553.610046a142.867108 142.867108 0 0 1-142.867108 142.867108h-235.373562l-153.224973 153.224974a107.150331 107.150331 0 0 1-75.719568 31.430764z" fill="#6B400D" p-id="15813"></path></svg>';Element.prototype.hasClass=function(e){return this.classList.contains(e)},Element.prototype.closest=function(e){var t=this,a=function(){if(e instanceof HTMLElement)return[e];try{e=document.querySelectorAll(e)}catch(e){}finally{var t=Object.prototype.toString.call(e).slice(8,-1);if(["NodeList","HTMLCollection","Array"].indexOf(t)>-1)return[].slice.call(e)}}();do{if(a.indexOf(t)>-1)return t;t=t.parentElement}while(null!==t);return null};var a,n,r=[],i=[],o=[],l=!1,s=0,c=0,d=0,p=0,u=null,h=null,g=null,v=!1,f=null,y="",m="",w="",b=null,x=null,A=null,S=null,q=1,P=!1,k=!0,E="",L=null,T=null,C=null,$="",M=null;function _(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()}function z(a){var n=a.pageNumber;setTimeout((()=>{!function(a){b&&clearInterval(b);b=null,r&&r.length&&function(a,n){var r=document.querySelector("#viewer .page").clientWidth;document.querySelectorAll(`.page[data-page-number='${n}'] .annotate`).forEach((e=>{e&&e.parentNode.removeChild(e)})),a.forEach((a=>{var i=JSON.parse(a.text),o=i.relateRect,l=`rgb(${i.color.r},${i.color.g},${i.color.b})`;if(i.contents)var s=i.contents;if(i.page+1==n)if(o.length>1)o.forEach(((e,o)=>{var c=document.createElement("div");if(c.classList.add("annotate"),c.setAttribute("data-type",a.type),"highlight"==a.type&&c.setAttribute("data-text",i.selectText||""),c.style=`background:${l};width:${e.width*r}px;height:${e.height*r}px;position:absolute;cursor:pointer;left:${e.x*r}px;top:${e.y*r}px;`,c.setAttribute("data-id",a.id),document.querySelector(`.page[data-page-number='${n}'] .textLayer`).appendChild(c),s&&0==o){var d=document.createElement("span");d.classList.add("comment-bar");c.style.background;d.style="position:abaolute;left:-8px;top:-6px;z-index:120;",d.innerHTML=t,d.setAttribute("data-title",s),c.appendChild(d)}}));else{var c=document.createElement("div");if(c.setAttribute("data-id",i.id),c.setAttribute("data-type",a.type),c.classList.add("annotate"),"highlight"==a.type&&c.setAttribute("data-text",i.selectText||""),"rect"==a.type){c.setAttribute("data-path",i.path);var d=document.createElement("div");d.classList.add("annotate-head"),c.appendChild(d);var p=document.createElement("div");p.classList.add("annotate-resize"),c.appendChild(p),p.innerHTML=e}if(i.relateRect&&i.relateRect.length)c.style=`background:${l};width:${i.relateRect[0].width*r}px;height:${i.relateRect[0].height*r}px;position:absolute;cursor:pointer;left:${i.relateRect[0].x*r}px;top:${i.relateRect[0].y*r}px;`,document.querySelector(`.page[data-page-number='${n}'] .textLayer`).appendChild(c);if(s){var u=document.createElement("span");u.classList.add("comment-bar");c.style.background;u.style="position:abaolute;left:-8px;top:-6px;z-index:120;",u.innerHTML=t,u.setAttribute("data-title",s),c.appendChild(u)}}})),I(n)}(r,a)}(n)}),10)}function I(e){var t,n;if(x&&(t=x,r&&0!=r.length)){if(r.filter((e=>{var a=JSON.parse(e.text);return e.id==t&&(n=parseInt(a.page)+1,!0)})).length){var i=document.querySelector(`.textLayer .annotate[data-id = '${t}']`);if(i){a.currentPageNumber=n,a._currentPage=a.currentPageNumber;var o=parseInt(i.style.top);A&&clearTimeout(A),A=setTimeout((()=>{var e=document.querySelector("#viewerContainer");e.scrollTop=e.scrollTop+o-100,document.querySelectorAll(`.textLayer .annotate[data-id = '${t}']`).forEach((e=>{e&&e.classList.add("active")}))}),0)}else a.currentPageNumber=n,a._currentPage=n,A&&clearTimeout(A),this.setTime=setTimeout((()=>{var e=document.querySelector(`.textLayer .annotate[data-id = '${t}']`);if(e){var a=parseInt(e.style.top);setTimeout((()=>{var e=document.querySelector("#viewerContainer");e.scrollTop=e.scrollTop+a-100}),30),document.querySelectorAll(`.textLayer .annotate[data-id = '${t}']`).forEach((e=>{e&&e.classList.add("active")}))}}),0)}n==e&&(x="")}}function R(e,t){if(r.length){var n=null;if(r.forEach((t=>{t.id==e&&(n=t)})),n){document.querySelectorAll(".annotate.active").forEach((e=>{e.classList.remove("active")}));var i=document.querySelector(`.annotate[data-id = '${e}']`);if(i){var o=i.closest(".page").getAttribute("data-page-number");a.currentPageNumber=parseInt(o);var l=parseInt(i.style.top);setTimeout((()=>{var e=document.querySelector("#viewerContainer");e.scrollTop=e.scrollTop+l-60}),80),document.querySelectorAll(`.annotate[data-id = '${e}']`).forEach((e=>{e.classList.add("active")})),x=""}else{x=e;var s=JSON.parse(n.text);a.currentPageNumber=parseInt(s.page)+1}}}}document.addEventListener("selectionchange",(e=>{M&&clearTimeout(M),M=setTimeout((()=>{var e=window.getSelection(),t=e.getRangeAt(0);if(t){T=D(),L=t.getClientRects(),C=function(){let e=window.getSelection().getRangeAt(0).getBoundingClientRect(),t=D(),n=e.x-t.left,r=e.y-t.top,i=n+e.width,o=r+e.height;var l=[n,r,i,o];let s=a._pages[a._currentPage-1].viewport.convertToPdfPoint(n,r);n=s[0],r=s[1];let c=a._pages[a._currentPage-1].viewport.convertToPdfPoint(i,o);return i=c[0],o=c[1],[n,r,i,o].concat(l)}();var n=t.cloneContents();$="";for(var r=0;r<n.children.length;r++)$+=n.children[r].textContent+" ";($=$.trim())||($=e.toString()||"")}}),400)})),document.onkeydown=function(e){var t=e.altKey;!t||"y"!=e.key&&"Y"!=e.key||F({r:247,g:255,b:0}),!t||"g"!=e.key&&"G"!=e.key||F({r:125,g:240,b:102}),!t||"b"!=e.key&&"B"!=e.key||F({r:143,g:222,b:249}),!t||"p"!=e.key&&"P"!=e.key||F({r:247,g:153,b:209}),!t||"r"!=e.key&&"R"!=e.key||F({r:253,g:73,b:73});var a=e.key.toLowerCase();if(t&&("delete"==a||"backspace"==a)){var n=document.querySelector(".annoate-btn.delete");n&&n.click()}};var N=document.querySelector("#viewerContainer");function D(){a._currentPage;var e=document.querySelector(`.page[data-page-number="${a._currentPage}"]`).querySelector("canvas"),t=(document.querySelector(".showpdf"),e.getBoundingClientRect());return{top:t.top,left:t.left}}function H(t){try{P?(s=t.touches[0].pageX,c=t.touches[0].pageY):(s=t.pageX,c=t.pageY),g=null,document.querySelectorAll(".annotate.active").forEach((e=>{e&&e.classList.remove("active")}));var n=t.target;if(n.closest(".page")){var r=n.closest(".page"),d=r.getAttribute("data-page-number");a._currentPage=parseInt(d),h=r.querySelector(".textLayer")}if(v||(i=[],o=[]),n.hasClass("annotate-head")||n.hasClass(".annotate-resize")||n.closest(".annotate-resize")){var p=n.closest(".annotate");if(n.hasClass("annotate-head"))var y="move";else y="resize";return void(f={ele:p,left:parseInt(p.style.left),top:parseInt(p.style.top),width:p.clientWidth,height:p.clientHeight,type:y})}let E=D();if(P)var m=t.touches[0].pageX-E.left,w=t.touches[0].pageY-E.top;else m=t.pageX-E.left,w=t.pageY-E.top;var b=m,x=w;o.push(m),o.push(w);let L=a._pages[a._currentPage-1].viewport.convertToPdfPoint(m,w);if(m=L[0],w=L[1],i.push(m),i.push(w),v){t.preventDefault(),l=!0,N.style.cursor="pointer",(u=document.createElement("div")).classList.add("annotate"),u.setAttribute("data-type","rect"),u.setAttribute("style",`position:absolute;background:#f9e9cc;left:${b-2}px;top:${x-2}px`);var A=document.createElement("div");A.classList.add("annotate-head"),u.appendChild(A);var S=document.createElement("div");S.classList.add("annotate-resize"),u.appendChild(S),S.innerHTML=e,h.appendChild(u);for(var q=0;q<h.children.length;q++){var k=h.children[q];k.style&&(k.style.userSelect="none",k.style.cursor="pointer")}}}catch(e){console.log(e)}}function O(e){if(f)return e.preventDefault(),P?(d=e.touches[0].pageX-s,p=e.touches[0].pageY-c):(d=e.pageX-s,p=e.pageY-c),void("move"==f.type?(f.ele.style.left=f.left+d+"px",f.ele.style.top=f.top+p+"px"):(f.ele.style.width=f.width+d+"px",f.ele.style.height=f.height+p+"px"));l&&v&&(e.preventDefault(),P?(d=e.touches[0].pageX-s,p=e.touches[0].pageY-c):(d=e.pageX-s,p=e.pageY-c),u.style.width=d-2+"px",u.style.height=p-2+"px")}function W(e){var t=document.querySelector("#viewer .page").clientWidth;if(N.style.cursor="auto",f&&!v){var n=f.ele.getAttribute("data-id"),g="";return r.forEach((e=>{if(e.id==n){var a=JSON.parse(e.text);e.width=f.ele.clientWidth,e.height=f.ele.clientHeight;var r=parseInt(f.ele.style.left),i=parseInt(f.ele.style.top);g=a.path;var o=[{x:r/t,y:i/t,width:e.width/t,height:e.height/t}];a.relateRect=o,e.text=JSON.stringify(a)}})),B(g,{left:parseInt(f.ele.style.left),top:parseInt(f.ele.style.top),width:f.ele.clientWidth,height:f.ele.clientHeight},!1,h,f.ele,{id:n}),void(f=null)}if(l&&v){v=!1;var b={id:_(),page:a._currentPage-1,rect:i.slice(),contents:"",author:"",color:{r:249,g:233,b:204},opacity:1,path:"",relateRect:null,pdfName:"",pageWidth:t},x=parseInt(u.style.left),A=parseInt(u.style.top),S=d,q=p,P=+new Date;if(E)var k=E+"/"+P+".png";else if(y.startsWith("file:")){var L=w.lastIndexOf("/");k=w.substr(0,L+1)+P+".png"}else L=y.lastIndexOf("/"),k=y.substr(0,L+1)+m+"-"+P+".png";B(k,{left:x,top:A,width:S,height:q},!0,h,u,b);for(L=0;L<h.children.length;L++){var T=h.children[L];T.style&&(T.style.userSelect="",T.style.cursor="")}o=[],i=[],s=0,c=0,l=!1,v=!1}}function B(e,t,a,n,i,o){var l=document.querySelector("#viewer .page").clientWidth,s=document.createElement("canvas");s.width=t.width,s.height=t.height;var c=s.getContext("2d"),d=n.closest(".page").querySelector("canvas");let p=(window.devicePixelRatio||1)/(c.webkitBackingStorePixelRatio||c.mozBackingStorePixelRatio||c.msBackingStorePixelRatio||c.oBackingStorePixelRatio||c.backingStorePixelRatio||1);c.drawImage(d,t.left*p,t.top*p,t.width*p,t.height*p,0,0,t.width,t.height);var u=function(e){for(var t=window.atob(e),a=t.length,n=new Uint8Array(a),r=0;r<a;r++)n[r]=t.charCodeAt(r);return n.buffer}(s.toDataURL().replace(/^data:image\/\w+;base64,/,"")),h=[{x:t.left/l,y:t.top/l,width:t.width/l,height:t.height/l}];o.relateRect=h||[],o.pdfName=y,o.path=e,a&&(i.setAttribute("data-id",o.id),i.setAttribute("data-path",e),r.push({id:o.id,text:JSON.stringify(o),type:"rect",page:o.page,width:t.width,height:t.height,pdfName:y})),window.parent.postMessage({type:"createRect",imagePath:e,dataBuffer:u,annotations:r,isNew:a,data:o,relateRect:h,imageOptions:t,_viewMark:S},"*"),setTimeout((()=>{a&&(i=null)}),500)}function F(e){if(g){var t=document.querySelector(".annotate.active");if(t){var n=t.getAttribute("data-id"),i=document.querySelectorAll(".annotate.active"),o=`rgb(${e.r},${e.g},${e.b})`;i.forEach((e=>{e.style.background=o})),r.forEach((t=>{if(t.id==n){var a=JSON.parse(t.text);a.color=e,t.text=JSON.stringify(a)}})),window.parent.postMessage({type:"updateHighlight",annotations:r,_viewMark:S},"*")}}else if(L){var l=L,s=C,c=$,d=document.querySelector("#viewer .page").clientWidth;if(1==l.length)var p=s.slice(0,4),u=[{x:s[4]/d,y:s[5]/d,width:(s[6]-s[4])/d,height:(s[7]-s[5])/d}],h={id:_(),page:a._currentPage-1,rect:p,contents:"",author:"",color:e,opacity:1,quadPoints:null,selectText:"",relateRect:null,pageWidth:d};else{h={id:_(),page:a._currentPage-1,rect:s.slice(0,4),contents:"",author:"",color:e,opacity:1,quadPoints:null,selectText:"",relateRect:null,pageWidth:d};let t=T;var v=[],f=[];u=[];l.length>2&&(l=function(e){var t=[];for(let i=0;i<e.length;i++)for(var a=i;a<e.length;a++)if(i!=a){var n=e[i],r=e[a];n.x<=r.x&&n.y<=r.y&&n.bottom>=r.bottom&&n.right>=r.right&&t.push(a)}var i=[];if(t.length){for(let a=0;a<e.length;a++)-1==t.indexOf(a)&&i.push(e[a]);return i}return e}(l)),l=function(e){for(var t={1:[e[0]]},a=1,n=e[0].bottom,r=1;r<e.length;r++){t[a]||(t[a]=[]);var i=e[r].height;e[r].top<n&&e[r].bottom<n+i/3||(t[++a]||(t[a]=[]),n=e[r].bottom),t[a].push(e[r])}var o=[];for(var l in t){let e,a,n,r;t[l].forEach(((t,i)=>{0==i?(e=t.x,a=t.y,n=t.bottom,r=t.right):(t.x<e&&(e=t.x),t.y<a&&(a=t.y),t.bottom>n&&(n=t.bottom),t.right>r&&(r=t.right))}));var s={x:e,y:a,top:e,left:a,bottom:n,right:r,width:r-e,height:n-a};o.push(s)}return o}(l);for(var m=0;m<l.length;m++){var w=l[m];let e=w.x-t.left;var b=w.y-t.top;let n=e+w.width;var x=b+w.height;f.push({x:e,y:b,width:w.width,height:w.height}),u.push({x:e/d,y:b/d,width:w.width/d,height:w.height/d}),m>0&&(b+=2);var A=a._pages[a._currentPage-1].viewport.convertToPdfPoint(e,b),q=A[0],P=A[1],k=a._pages[a._currentPage-1].viewport.convertToPdfPoint(n,x),E=k[0],M=k[1],z=q,I=M,R=E,N=P;v.push(z,I,E,M,q,P,R,N)}h.quadPoints=v}h.relateRect=u,h.selectText=c;o=`rgb(${e.r},${e.g},${e.b})`;if(l.length>1)f.forEach((e=>{var t=document.createElement("div");t.classList.add("annotate"),t.setAttribute("data-id",h.id),t.setAttribute("data-type","highlight"),t.setAttribute("data-text",c||""),t.setAttribute("style",`background:${o};width:${e.width}px;height:${e.height}px;position:absolute;cursor:pointer;left:${e.x}px;top:${e.y}px;`),document.querySelector(`[data-page-number='${a._currentPage}'] .textLayer`).appendChild(t)}));else{var D=document.createElement("div");D.classList.add("annotate"),D.setAttribute("data-id",h.id),D.setAttribute("data-type","highlight"),D.setAttribute("data-text",c||""),D.setAttribute("style",`background:${o};width:${s[6]-s[4]}px;height:${s[7]-s[5]}px;position:absolute;cursor:pointer;left:${s[4]}px;top:${s[5]}px;`),document.querySelector(`[data-page-number='${a._currentPage}'] .textLayer`).appendChild(D)}new Date;h.relateRect=u||[],h.pdfName=y,r.push({id:h.id,page:h.page,text:JSON.stringify(h),type:"highlight",selectText:c,pdfName:h.pdfName}),window.parent.postMessage({type:"createHighlight",annotations:r,_viewMark:S},"*"),T=null,L=null,C=null,$=null}}window.addEventListener("message",(function(e){switch(e.data.type){case"openPDF":e.data._viewMark&&(S=e.data._viewMark),y=e.data.pdfName,m=e.data.basename,r=e.data.annotations,e.data.openProtocol,x=e.data.id,P=e.data.isMobile,w=e.data.mdPath,E=e.data.imageFolder,k&&(P?(N.addEventListener("touchstart",H),N.addEventListener("touchmove",O),N.addEventListener("touchend",W)):(N.addEventListener("mousedown",H),N.addEventListener("mousemove",O),N.addEventListener("mouseup",W)),k=!1),setTimeout((function(){PDFViewerApplication&&(PDFViewerApplication.open(e.data.data).then((()=>{(a=PDFViewerApplication.pdfViewer)._currentPage=1,PDFViewerApplication.pdfDocument.getData().then((e=>{P||(n=new pdfAnnotate.AnnotationFactory(e)),a.currentScaleValue="page-width"})),e.data.id&&R(e.data.id)})),PDFViewerApplication.eventBus.on("pagerendered",z))}),1e3);break;case"closePDF":break;case"showAnnotate":R(e.data.id);break;case"exportAnnotatePDF":var t=document.querySelector("#viewer .page").clientWidth,i=(new Date,null);setTimeout((()=>{r.forEach((e=>{var r=JSON.parse(e.text);if(n){1!=q&&n.deleteAnnotation(r.id);var i=r.relateRect,o={page:r.page,rect:r.rect,contents:r.contents||"",author:"",color:r.color,opacity:.8,id:r.id,quadPoints:[],fill:""};if(i.forEach((e=>{var n=parseInt(e.x*t+""),i=parseInt(e.y*t+""),l=parseInt(e.width*t+""),s=parseInt(e.height*t+"");let c=a._pages[r.page].viewport.convertToPdfPoint(n,i);var d=c[0],p=c[1];let u=a._pages[r.page].viewport.convertToPdfPoint(n+l,i+s);var h=u[0],g=u[1],v=d,f=g,y=h,m=p;o.quadPoints.push(v,f,h,g,d,p,y,m)})),"highlight"==e.type){if(o.rect.length<4)return;n.createHighlightAnnotation(o)}else o.fill=r.color,o.opacity=.3,o.quadPoints.length&&(o.rect=[o.quadPoints[2],o.quadPoints[3],o.quadPoints[4],o.quadPoints[5]],n.createSquareAnnotation(o))}}));new Date;i=n.write(),q++,setTimeout((function(){window.parent.postMessage({type:"exportAnnotatePDF",pdfData:i,_viewMark:S},"*")}),200)}),200)}}),!1),document.querySelector(".annotate-bar").addEventListener("click",(function(e){var a=e.target;if(a.hasClass("annoate-btn")||a.closest(".annoate-btn")){if(a.hasClass("annoate-btn"))var n=a.getAttribute("title");else n=a.closest(".annoate-btn").getAttribute("title");if("highlight"==n){var i=a.getAttribute("data-color").split(",");F({r:i[0],g:i[1],b:i[2]})}else if("rect"==n)(v=!v)?window.parent.postMessage({type:"create rect annotate",_viewMark:S},"*"):window.parent.postMessage({type:"cancel create rect annotate",_viewMark:S},"*");else if("delete annotate"==n){if(!(w=document.querySelector(".annotate.active")))return;var o=w.getAttribute("data-id"),l=null;if(r.forEach(((e,t)=>{e.id==o&&(l=t)})),l>-1)r.splice(l,1),window.parent.postMessage({type:"deleteAnnotate",annotations:r,_viewMark:S},"*"),document.querySelectorAll(`.annotate[data-id="${o}"]`).forEach((e=>{var t=e.parentElement;t&&t.removeChild(e)})),window.parent.postMessage({type:"delete mindmap annotate",id:o,_viewMark:S},"*")}else if("comment"==n){if(!(w=document.querySelector(".annotate.active")))return;o=w.getAttribute("data-id");var s=w.closest(".page"),c=w.querySelector(".comment-bar");if(c)var d=c.getAttribute("data-title");var p=parseInt(w.style.left),u=parseInt(w.style.top),h=parseInt(w.clientHeight),g=document.createElement("div");g.classList.add("annotate-comment");var f=document.createElement("textarea");g.appendChild(f),g.style.left=p+"px",g.style.top=u+h+10+"px",g.style.minWidth="100px",g.style.minHeight="80px",g.style.position="absolute",g.style.zIndex=200,g.style.backgroundColor="rgb(242 253 184)",g.style.color="#333",s.appendChild(g);var y=document.createElement("span");y.innerText="X",y.style.position="absolute",y.style.color="red",y.style.right="10px",y.style.top="10px",y.style.zIndex="20",y.style.fontSize="12px",y.style.cursor="pointer",g.appendChild(y),y.onclick=function(){y.onclick=null,s.removeChild(g),g.innerText="",g=null},d&&(f.value=d);var m="";f.onfocus=function(){m=this.value.trim()},f.onblur=function(){var e=this.value.trim();if(e!=m)if(r.forEach((t=>{var a=JSON.parse(t.text);a.id==o&&(a.contents=e,a.commentTime=+new Date,t.text=JSON.stringify(a))})),window.parent.postMessage({type:"comment",_viewMark:S,annotations:r},"*"),e){var a=w.querySelector(".comment-bar");if(a)a.setAttribute("data-title",e);else{(n=document.createElement("span")).classList.add("comment-bar");w.style.background;n.style="position:abaolute;left:-8px;top:-6px;z-index:120;",n.innerHTML=t,n.setAttribute("data-title",e),w.appendChild(n)}}else{var n;(n=w.querySelector(".comment-bar"))&&w.removeChild(n)}f.onfocus=null,f.onblur=null,s.removeChild(g),m=""}}else if("search"==n){var w;if(!(w=document.querySelector(".annotate.active")))return;o=w.getAttribute("data-id");window.parent.postMessage({type:"search",id:o,_viewMark:S})}}})),N.addEventListener("click",(function(e){var t=e.target;if(t&&(t.hasClass("comment-bar")||t.closest(".comment-bar"))){if(t.hasClass("comment-bar"))var a=t.getAttribute("data-title");else a=t.closest(".comment-bar").getAttribute("data-title");var n=t.closest(".annotate");if(n){var r=parseInt(n.style.left),i=parseInt(n.style.top),o=parseInt(n.clientHeight),l=t.closest(".page"),s=document.createElement("div");s.classList.add("annotate-comment"),s.style.left=r+"px",s.style.top=i+o+10+"px",s.style.minWidth="100px",s.style.minHeight="80px",s.style.position="absolute",s.style.padding="10px",s.style.zIndex=200,s.style.backgroundColor="rgb(242 253 184)",s.style.color="#333",s.innerText=a||"",s.style.paddingTop="4px",l.appendChild(s);var c=document.createElement("span");c.innerText="X",c.style.float="right",c.style.color="red",c.style.right="10px",c.style.top="10px",c.style.fontSize="12px",c.style.cursor="pointer",s.appendChild(c),c.onclick=function(){c.onclick=null,l.removeChild(s),s.innerText="",s=null}}}})),N.addEventListener("click",(function(e){var t=e.target;if(t.hasClass("annotate")||t.closest(".annotate")){if(g=!0,t.hasClass("annotate"))var a=t;else t.closest(".annotate")&&(a=t.closest(".annotate"));if(a){var n=a.getAttribute("data-id");document.querySelectorAll(`.annotate[data-id = '${n}']`).forEach((e=>{e.classList.contains("active")||e.classList.add("active")}));var i=r.filter((e=>e.id==n)),o=a.getAttribute("data-type");if(i.length){var l={id:n,type:o,action:"create pdf annotate",text:i[0].text,path:"",width:0,height:0,selectText:""};if("rect"==o){var s=a.getAttribute("data-path"),c=a.clientWidth,d=a.clientHeight;l.path=s,l.width=c,l.height=d}else l.selectText=a.getAttribute("data-text");window.parent.postMessage({id:n,type:"showMindmapAnnotate",annotateType:o,path:l.path||"",selectText:l.selectText||"",data:l,_viewMark:S},"*")}}}else this.selectAnnotate=null}))};